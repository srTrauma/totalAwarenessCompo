(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{6112:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/companies/edit/[id]",function(){return a(44)}])},44:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return c}});var r=a(5893),l=a(7294),t=a(1163),n=a(9008),i=a.n(n),o=a(1029),d=a(1192);function c(){let e=(0,t.useRouter)(),{id:s}=e.query,[a,n]=(0,l.useState)(null),[c,m]=(0,l.useState)(null),[u,x]=(0,l.useState)(""),[h,b]=(0,l.useState)(""),[p,j]=(0,l.useState)(!1),[f,g]=(0,l.useState)(!0),[N,y]=(0,l.useState)(!1),[w,v]=(0,l.useState)(""),[E,k]=(0,l.useState)(!1);async function S(){if(s)try{g(!0);let r=await fetch("/api/companies/detail?companyId=".concat(s),{headers:{userid:a.id.toString()}});if(r.ok){let e=await r.json();m(e),x(e.name),b(e.description||""),j(e.public)}else{let s=await r.json();v(s.message||"Error al cargar detalles de la empresa"),setTimeout(()=>{e.push("/Dashboard")},3e3)}}catch(s){console.error("Error al cargar detalles de la empresa:",s),v("Error al conectar con el servidor"),setTimeout(()=>{e.push("/Dashboard")},3e3)}finally{g(!1)}}async function C(){if(!u.trim()){v("El nombre de la empresa es obligatorio");return}try{y(!0);let r=await fetch("/api/companies/update",{method:"PUT",headers:{"Content-Type":"application/json",userid:a.id.toString()},body:JSON.stringify({companyId:Number(s),name:u.trim(),description:h.trim()||null,public:p})});if(r.ok)alert("Empresa actualizada correctamente"),e.push("/Dashboard");else{let e=await r.json();v(e.message||"Error al actualizar la empresa")}}catch(e){console.error("Error al actualizar la empresa:",e),v("Error al conectar con el servidor")}finally{y(!1)}}async function _(){try{y(!0);let r=await fetch("/api/companies/delete",{method:"DELETE",headers:{"Content-Type":"application/json",userid:a.id.toString()},body:JSON.stringify({companyId:Number(s)})});if(r.ok)alert("Empresa eliminada correctamente"),localStorage.removeItem("selectedCompany"),e.push("/CompanySelection");else{let e=await r.json();v(e.message||"Error al eliminar la empresa")}}catch(e){console.error("Error al eliminar la empresa:",e),v("Error al conectar con el servidor")}finally{y(!1),k(!1)}}function T(){e.push("/Dashboard")}return((0,l.useEffect)(()=>{let s=localStorage.getItem("user");s?n(JSON.parse(s)):e.push("/Login")},[e]),(0,l.useEffect)(()=>{s&&a&&S()},[s,a]),f)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{children:"Cargando... | Total Awareness"})}),(0,r.jsx)(o.Z,{}),(0,r.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})]}):w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{children:"Error | Total Awareness"})}),(0,r.jsx)(o.Z,{}),(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[(0,r.jsxs)("button",{onClick:T,className:"flex items-center text-blue-600 mb-6 hover:underline",children:[(0,r.jsx)(d.x_l,{className:"mr-2"})," Volver al Dashboard"]}),(0,r.jsxs)("div",{className:"p-6 bg-red-50 rounded-lg border border-red-200",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-red-700 mb-2",children:"Error"}),(0,r.jsx)("p",{className:"text-red-600",children:w})]})]})]}):c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i(),{children:(0,r.jsxs)("title",{children:["Editar Empresa | ",c.name," | Total Awareness"]})}),(0,r.jsx)(o.Z,{}),(0,r.jsxs)("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("button",{onClick:T,className:"flex items-center text-blue-600 mb-8 hover:underline",children:[(0,r.jsx)(d.x_l,{className:"mr-2"})," Volver al Dashboard"]}),(0,r.jsx)("div",{className:"bg-white shadow-md rounded-xl overflow-hidden",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center mb-8",children:[(0,r.jsx)("div",{className:"bg-blue-100 rounded-full p-4 mr-4",children:(0,r.jsx)(d.m17,{className:"text-blue-600 text-3xl"})}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Editar Empresa"})]}),w&&(0,r.jsx)("div",{className:"p-4 mb-6 bg-red-50 border border-red-200 rounded-md text-red-600",children:w}),(0,r.jsxs)("form",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la empresa *"}),(0,r.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),className:"w-full p-3 border rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Ingresa el nombre de la empresa"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,r.jsx)("textarea",{value:h,onChange:e=>b(e.target.value),className:"w-full p-3 border rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Descripci\xf3n opcional",rows:4})]}),c.isOwner&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"isPublic",checked:p,onChange:e=>j(e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"isPublic",className:"ml-2 block text-sm text-gray-700",children:"Empresa p\xfablica (cualquier usuario puede unirse sin aprobaci\xf3n)"})]}),(0,r.jsxs)("div",{className:"flex justify-between pt-6 border-t",children:[(0,r.jsx)("div",{children:c.isOwner&&(0,r.jsxs)("button",{type:"button",onClick:()=>k(!0),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors flex items-center",children:[(0,r.jsx)(d.Xm5,{className:"mr-2"})," Eliminar empresa"]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("button",{type:"button",onClick:C,disabled:N,className:"px-8 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center disabled:bg-blue-400 disabled:cursor-not-allowed",children:[(0,r.jsx)(d.TvB,{className:"mr-2"}),N?"Guardando...":"Guardar cambios"]})})]})]})]})})]}),E&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold mb-4 text-red-600",children:"\xbfEst\xe1s seguro de eliminar esta empresa?"}),(0,r.jsxs)("p",{className:"mb-6 text-gray-600",children:["Esta acci\xf3n eliminar\xe1 permanentemente la empresa ",(0,r.jsx)("strong",{children:c.name})," y todos sus datos asociados. Esta acci\xf3n no se puede deshacer."]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)("button",{onClick:()=>k(!1),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancelar"}),(0,r.jsx)("button",{onClick:_,disabled:N,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700",children:N?"Eliminando...":"S\xed, eliminar empresa"})]})]})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{children:"Empresa no encontrada | Total Awareness"})}),(0,r.jsx)(o.Z,{}),(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[(0,r.jsxs)("button",{onClick:T,className:"flex items-center text-blue-600 mb-6 hover:underline",children:[(0,r.jsx)(d.x_l,{className:"mr-2"})," Volver al Dashboard"]}),(0,r.jsxs)("div",{className:"p-6 bg-yellow-50 rounded-lg border border-yellow-200",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-yellow-700 mb-2",children:"Empresa no encontrada"}),(0,r.jsx)("p",{className:"text-yellow-600",children:"No se encontr\xf3 la empresa solicitada o no tienes acceso a ella."})]})]})]})}a(4390)}},function(e){e.O(0,[365,717,912,833,888,774,179],function(){return e(e.s=6112)}),_N_E=e.O()}]);