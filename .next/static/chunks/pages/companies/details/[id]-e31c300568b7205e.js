(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14],{6196:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/companies/details/[id]",function(){return r(9622)}])},9622:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return o}});var a=r(5893),t=r(7294),l=r(1163),n=r(9008),i=r.n(n),c=r(1029),d=r(1192);function o(){let e=(0,l.useRouter)(),{id:s}=e.query,[r,n]=(0,t.useState)(null),[o,m]=(0,t.useState)(null),[x,u]=(0,t.useState)(!0),[h,p]=(0,t.useState)(""),[j,b]=(0,t.useState)("Unirse"),[N,g]=(0,t.useState)(!1);async function f(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(s)try{u(!0);let a={};r&&(a.userid=r.id.toString());let t=await fetch("/api/companies/detail?companyId=".concat(s),{headers:a});if(t.ok){let e=await t.json();m(e),"pending"===e.currentUserStatus?(b("Solicitud pendiente"),g(!0)):"approved"===e.currentUserStatus?(b("Ya eres miembro"),g(!0)):(b(e.public?"Unirse":"Solicitar acceso"),g(!1))}else if(403===t.status&&(e||!r))p("Esta empresa no es p\xfablica. Inicia sesi\xf3n para solicitar acceso.");else{let e=await t.json();p(e.message||"Error al cargar detalles de la empresa")}}catch(e){console.error("Error al cargar detalles de la empresa:",e),p("Error al conectar con el servidor")}finally{u(!1)}}async function y(){if(!r){e.push("/Login?redirect=/companies/details/".concat(s));return}try{g(!0);let e=await fetch("/api/companies/join",{method:"POST",headers:{"Content-Type":"application/json",userid:r.id.toString()},body:JSON.stringify({userId:r.id,companyId:Number(s)})});if(e.ok){let s=await e.json();alert(s.message),(null==o?void 0:o.public)?b("Ya eres miembro"):b("Solicitud pendiente"),g(!0),f()}else{let s=await e.json();alert(s.message||"Error al unirse a la empresa"),g(!1)}}catch(e){console.error("Error al unirse a la empresa:",e),alert("Error al conectar con el servidor"),g(!1)}}function v(){e.back()}return((0,t.useEffect)(()=>{let e=localStorage.getItem("user");e&&n(JSON.parse(e))},[]),(0,t.useEffect)(()=>{s&&r?f():s&&!r&&f(!0)},[s,r]),x)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i(),{children:(0,a.jsx)("title",{children:"Cargando... | Total Awareness"})}),(0,a.jsx)(c.Z,{}),(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})]}):h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i(),{children:(0,a.jsx)("title",{children:"Error | Total Awareness"})}),(0,a.jsx)(c.Z,{}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[(0,a.jsxs)("button",{onClick:v,className:"flex items-center text-blue-600 mb-6 hover:underline",children:[(0,a.jsx)(d.x_l,{className:"mr-2"})," Volver"]}),(0,a.jsxs)("div",{className:"p-6 bg-red-50 rounded-lg border border-red-200",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-red-700 mb-2",children:"Error"}),(0,a.jsx)("p",{className:"text-red-600",children:h}),h.includes("no es p\xfablica")&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("button",{onClick:()=>e.push("/Login"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Iniciar sesi\xf3n"})})]})]})]}):o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i(),{children:(0,a.jsxs)("title",{children:[o.name," | Total Awareness"]})}),(0,a.jsx)(c.Z,{}),(0,a.jsxs)("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("button",{onClick:v,className:"flex items-center text-blue-600 mb-8 hover:underline",children:[(0,a.jsx)(d.x_l,{className:"mr-2"})," Volver"]}),(0,a.jsx)("div",{className:"bg-white shadow-md rounded-xl overflow-hidden",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"bg-blue-100 rounded-full p-4",children:(0,a.jsx)(d.m17,{className:"text-blue-600 text-3xl"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:o.name}),(0,a.jsx)("div",{className:"flex items-center mt-1",children:o.public?(0,a.jsxs)("span",{className:"flex items-center text-green-600",children:[(0,a.jsx)(d.ssk,{className:"mr-1"})," P\xfablica"]}):(0,a.jsxs)("span",{className:"flex items-center text-yellow-600",children:[(0,a.jsx)(d.kUi,{className:"mr-1"})," Privada"]})})]})]}),(0,a.jsx)("div",{className:"mt-2",children:"approved"===o.currentUserStatus?(0,a.jsx)("button",{onClick:function(){localStorage.setItem("selectedCompany",String(null==o?void 0:o.id)),e.push("/Dashboard")},className:"px-5 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Entrar"}):(0,a.jsx)("button",{onClick:y,disabled:N,className:"px-5 py-2 rounded-md transition-colors ".concat(N?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:j})})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Descripci\xf3n"}),(0,a.jsx)("p",{className:"text-gray-600",children:o.description||"Esta empresa no tiene descripci\xf3n."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Propietario"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.Xws,{className:"text-gray-400 mr-2"}),(0,a.jsx)("p",{className:"text-gray-800",children:o.owner.name})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Miembros"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.I$,{className:"text-gray-400 mr-2"}),(0,a.jsx)("p",{className:"text-gray-800",children:o.memberCount})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Creado"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.IiJ,{className:"text-gray-400 mr-2"}),(0,a.jsx)("p",{className:"text-gray-800",children:new Date(o.createdAt).toLocaleDateString()})]})]}),r&&o.currentUserRole&&(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Tu rol"}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("p",{className:"text-gray-800",children:[o.currentUserRole.name,o.isOwner&&" (Propietario)"]})})]})]}),r&&"pending"===o.currentUserStatus&&(0,a.jsx)("div",{className:"bg-yellow-50 p-4 rounded-md border border-yellow-200 mb-6",children:(0,a.jsx)("p",{className:"text-yellow-700",children:"Tu solicitud para unirte a esta empresa est\xe1 pendiente de aprobaci\xf3n por parte del propietario o administrador."})})]})})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i(),{children:(0,a.jsx)("title",{children:"Empresa no encontrada | Total Awareness"})}),(0,a.jsx)(c.Z,{}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[(0,a.jsxs)("button",{onClick:v,className:"flex items-center text-blue-600 mb-6 hover:underline",children:[(0,a.jsx)(d.x_l,{className:"mr-2"})," Volver"]}),(0,a.jsxs)("div",{className:"p-6 bg-yellow-50 rounded-lg border border-yellow-200",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-yellow-700 mb-2",children:"Empresa no encontrada"}),(0,a.jsx)("p",{className:"text-yellow-600",children:"No se encontr\xf3 la empresa solicitada o no tienes acceso a ella."})]})]})]})}r(4390)}},function(e){e.O(0,[365,717,912,833,888,774,179],function(){return e(e.s=6196)}),_N_E=e.O()}]);