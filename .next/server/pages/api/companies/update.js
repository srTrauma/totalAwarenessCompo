"use strict";(()=>{var e={};e.id=934,e.ids=[934],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8781:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,a){return a in r?r[a]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,a)):"function"==typeof r&&"default"===a?r:void 0}}})},735:(e,r,a)=>{a.r(r),a.d(r,{config:()=>l,default:()=>d,routeModule:()=>p});var t={};a.r(t),a.d(t,{default:()=>u});var n=a(1802),i=a(7153),s=a(8781);let o=new(a(3524)).PrismaClient;async function u(e,r){if("PUT"!==e.method)return r.status(405).json({message:"M\xe9todo no permitido"});try{let{companyId:a,name:t,description:n,public:i}=e.body,s=e.headers.userid;if(!a)return r.status(400).json({message:"El ID de la empresa es obligatorio"});let u=await o.company.findUnique({where:{id:a}});if(!u)return r.status(404).json({message:"Empresa no encontrada"});let d=await o.userCompany.findUnique({where:{userId_companyId:{userId:Number(s),companyId:a}},include:{role:!0}}),l=u.ownerId===Number(s),p=d?.role?.level!==void 0&&d.role.level<=2;if(!l&&!p)return r.status(403).json({message:"No tienes permisos para actualizar esta empresa"});if(void 0!==i&&!l)return r.status(403).json({message:"Solo el propietario puede cambiar el estado p\xfablico de la empresa"});if(t&&t!==u.name&&await o.company.findFirst({where:{name:t,ownerId:u.ownerId,id:{not:a}}}))return r.status(400).json({message:"Ya existe una empresa con ese nombre"});let m=await o.company.update({where:{id:a},data:{name:t||u.name,description:void 0!==n?n:u.description,public:void 0!==i?i:u.public}});r.status(200).json({message:"Empresa actualizada correctamente",company:m})}catch(e){console.error("Error al actualizar empresa:",e),r.status(500).json({message:"Error interno del servidor"})}}let d=(0,s.l)(t,"default"),l=(0,s.l)(t,"config"),p=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/companies/update",pathname:"/api/companies/update",bundlePath:"",filename:""},userland:t})},7153:(e,r)=>{var a;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,r,a)=>{e.exports=a(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var a=r(r.s=735);module.exports=a})();